=============================================
Лабораторна робота №3
=============================================

Тема
------

**Засоби відкладеної обробки, аллокація пам'яті**

Завдання:
-------
Переписати код з другої лабораторної роботи так, щоб замість звичайного таймера використовувався *hrtimer*.

Хід роботи
-------

**Опис виконаної роботи** 
В ході роботи в коді з другої лабораторної роботи звичайний таймер було замінено на таймер високої роздільної здатності. 

Було замінено структуру таймеру *timer_list* на *hrtimer* та додано змінну *period* типу *ktime_t*.

Змінено функцію-обробник для таймеру зі звичайної *void* на функцію типу *enum hrtimer_restart*, що є необхідною умовою для *hrtimers* так як ця функція повинна повертати значення, яке каже перезапускати таймер чи ні. Також у функції для таймеру було замінено функцію яка вказує коли потрібно наступного разу викликати функцію-обробник.

Далі параметр *delay* конвертується із секунд у тип *ktime* завдяки функції `ktime_set()`.

Далі ініціюємо *hrtimer*, вказуємо яка функція повинна виконуватись по таймеру і запускаємо його.

В *exit_callback* видаляємо таймер(так як він більше не потрібен).


Тести:

.. code-block:: bash

	/mnt # insmod lab_3.ko cnt=100 delay=1
	[  582.185176] 1 sec is 1000 jiffies
	[  582.187851] Init jiffies is 4295249367
	[  582.190747] Tasklet jiffies is 4295249370
	/mnt # rmmod lab_3
	[  603.554633] Exit jiffies is 4295270734
	[  603.559006] Array isn't full
	[  603.562890] Array[0] =		4295250370
	[  603.566252] Array[1] =		4295251370
	[  603.569189] Array[2] =		4295252370
	[  603.572611] Array[3] =		4295253370
	[  603.575478] Array[4] =		4295254370
	[  603.578277] Array[5] =		4295255370
	[  603.581536] Array[6] =		4295256370
	[  603.585578] Array[7] =		4295257370
	[  603.591541] Array[8] =		4295258370
	[  603.595087] Array[9] =		4295259370
	[  603.597966] Array[10] =		4295260370
	[  603.601349] Array[11] =		4295261370
	[  603.604263] Array[12] =		4295262370
	[  603.607518] Array[13] =		4295263370
	[  603.610381] Array[14] =		4295264370
	[  603.613768] Array[15] =		4295265370
	[  603.616406] Array[16] =		4295266370
	[  603.621555] Array[17] =		4295267370
	[  603.625379] Array[18] =		4295268370
	[  603.627903] Array[19] =		4295269370
	[  603.631196] Array[20] =		4295270370
	[  603.633857] Goodbye:)




Висновки
-------
В ході роботи було переписано код з лабораторної роботи №2 так, щоб замість звичайних таймерів використовувався *hrtimer*. Виконану роботу описано вище. В порівнянні з попередньою лабораторною роботою в цій *jiffies* кожного разу відрізняється на *delay*+1(час від часу).
*hrtimer* відрізняється від звичайного тим, що він має більшу роздільну здатність(*hrtimer* -> наносекунди, звичайний -> мілісекунди).



